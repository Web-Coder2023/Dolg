<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>О компании</title>
    <link rel="stylesheet" href="./css/style.min.css">
</head>

<body>
    <div class="wrapper">
        <!--=include header.html -->
        <main class="main">
            <!--=include section/writeoff.html -->
            <!--=include section/temp.html -->
            <!--=include section/company-action.html -->
            <!--=include section/company-callback.html -->
        </main>
        <!--=include footer.html -->
    </div>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
        // Валидация формы с reCAPTCHA (связь формы и капчи через JS)
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('callbackForm');
            const agreementCheckbox = document.getElementById('agreement');
            const recaptchaElement = document.getElementById('callbackRecaptcha');
            
            if (form && recaptchaElement) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Проверка соглашения на обработку данных
                    if (!agreementCheckbox || !agreementCheckbox.checked) {
                        alert('Пожалуйста, согласитесь на обработку персональных данных');
                        return false;
                    }
                    
                    // Проверка reCAPTCHA (связана с формой через ID)
                    // grecaptcha.getResponse() получает значение из виджета callbackRecaptcha
                    const recaptchaResponse = grecaptcha.getResponse();
                    
                    if (recaptchaResponse.length === 0) {
                        alert('Пожалуйста, подтвердите, что вы не робот');
                        // Подсветить блок с капчей
                        recaptchaElement.style.border = '2px solid red';
                        setTimeout(() => {
                            recaptchaElement.style.border = '';
                        }, 2000);
                        return false;
                    }
                    
                    // Если все проверки пройдены, отправляем форму
                    const formData = new FormData(form);
                    formData.append('g-recaptcha-response', recaptchaResponse);
                    
                    // Отправка формы
                    // Для WordPress темы используем путь к теме
                    fetch('/wp-content/themes/dolg/submit-form.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        // Проверяем статус ответа
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        // Проверяем, что ответ действительно JSON
                        const contentType = response.headers.get("content-type");
                        if (contentType && contentType.indexOf("application/json") !== -1) {
                            return response.json();
                        } else {
                            throw new Error('Сервер вернул не JSON ответ. Проверьте путь к submit-form.php');
                        }
                    })
                    .then(data => {
                        if (data.success) {
                            alert('Спасибо! Мы перезвоним вам в течение 15 минут');
                            form.reset();
                            grecaptcha.reset();
                        } else {
                            alert(data.message || 'Ошибка отправки формы. Попробуйте еще раз.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Ошибка: ' + error.message + '\n\nПроверьте:\n1. Файл submit-form.php загружен на хостинг\n2. Путь к файлу правильный\n3. PHP работает на сервере');
                    });
                });
            }
        });
    </script>
</body>

</html>